# フォルダ構成（Python / Pygame 向け）

本ドキュメントは、(仮) PyFight Online の開発における推奨フォルダ構成と、その意図（保守性とAIによるコード理解の向上）を整理したものです。

## 全体構成

```
project_root/
├── main.py
├── src/
│   ├── __init__.py
│   ├── engine/
│   ├── entities/
│   ├── network/
│   ├── states/
│   └── utils/
├── assets/
│   ├── images/
│   ├── sounds/
│   └── fonts/
├── docs/
├── tests/
└── requirements.txt
```

## 各要素の役割と配置するもの

### `main.py`

- **役割**
  - ゲームの起動エントリポイント。
  - ウィンドウ生成、初期化、ゲームループ開始の呼び出し口を提供する。
- **配置するもの（例）**
  - `main()` 関数
  - `Game` / `App` の生成と `run()` 呼び出し

### `src/`

- **役割**
  - アプリケーションのソースコード本体（Pythonパッケージ）。
  - 実装の責務ごとに分割し、依存関係を追いやすくする。
- **配置するもの（例）**
  - 各サブパッケージ（`engine`, `entities`, `network`, `states`, `utils`）

#### `src/engine/`

- **役割**
  - ゲームの「土台」機能を集約する。
  - ゲームループ、イベント管理、衝突判定ロジックなど、広範囲で使われる中核ロジックを置く。
- **配置するもの（例）**
  - `game_loop.py`（固定Δ/可変Δの更新管理）
  - `input.py`（入力抽象化）
  - `collision.py`（当たり判定、ヒットボックス/ハートボックス）
  - `time.py`（タイムリミット、フレーム管理）

#### `src/entities/`

- **役割**
  - ゲーム内に存在する「オブジェクト（実体）」を定義する。
- **配置するもの（例）**
  - `player.py`（Playerクラス）
  - `enemy.py`（CPU用の敵やダミー）
  - `hitbox.py`（判定用データ構造）

#### `src/network/`

- **役割**
  - オンライン対戦の通信処理を集約する。
  - 送受信・パケット整形・同期方式（Delay-based）をこの配下に閉じる。
- **配置するもの（例）**
  - `client.py` / `server.py`（方式に応じて）
  - `protocol.py`（メッセージ種別、シリアライズ/デシリアライズ）
  - `sync.py`（入力同期、遅延調整）

#### `src/states/`

- **役割**
  - 画面やゲーム状況の状態遷移（State Machine）を管理する。
  - 「タイトル」「マッチ」「ポーズ」「リザルト」などの遷移を明確にする。
- **配置するもの（例）**
  - `base.py`（State基底クラス）
  - `title.py`（タイトル画面）
  - `battle.py`（対戦画面）

#### `src/utils/`

- **役割**
  - 複数箇所から参照される設定値・共通関数を置く。
  - 循環参照を生みにくい、小さな依存の塊として維持する。
- **配置するもの（例）**
  - `constants.py`（画面サイズ、FPS、色、キー割当など）
  - `math.py`（ベクトル/補間などの軽量ヘルパ）

### `assets/`

- **役割**
  - 画像・音・フォントなどの素材をコードから分離して管理する。
- **配置するもの（例）**
  - `images/`：キャラクター、背景、エフェクト
  - `sounds/`：SE、BGM
  - `fonts/`：ゲーム用フォント

### `docs/`

- **役割**
  - 仕様・設計・運用ルールをコードと同じリポジトリで管理する。
- **配置するもの（例）**
  - `specification.md`（仕様書）
  - `folder_structure.md`（本ドキュメント）
  - `network_protocol.md`（通信仕様、メッセージ定義）

### `tests/`

- **役割**
  - 通信テスト、ユニットテスト、同期検証などをまとめる。
  - ゲーム本体とテストを分離し、開発中の検証を自動化しやすくする。
- **配置するもの（例）**
  - `test_network_delay.py`（遅延・順序入れ替えの検証）
  - `test_collision.py`（当たり判定のテスト）

### `requirements.txt`

- **役割**
  - 依存ライブラリの一覧を明文化し、開発環境の再現性を確保する。
- **配置するもの（例）**
  - `pygame-ce`
  - （必要に応じて）`PodSixNet`

## この構成にする理由（保守性 / AI理解の向上）

- **責務の分離が明確になる**
  - `engine`（土台）・`entities`（ゲームオブジェクト）・`states`（画面遷移）・`network`（通信）を分けることで、変更の影響範囲が局所化されます。

- **依存関係が読みやすくなる**
  - どの機能がどこに置かれるべきかが固定されるため、探索コストが下がり、レビューや引き継ぎが容易になります。

- **AIにとっての「探索空間」が減る**
  - モジュール境界が明確だと、AIが関連コードを見つけやすく、提案の精度が上がります。
  - 例：当たり判定の改善なら `src/engine/collision.py` を優先して参照できる。

- **オンライン要素を段階導入しやすい**
  - `network` を独立させることで、Phase 1〜2（ローカル完成）に影響を与えずに Phase 3（同期）を追加しやすくなります。
